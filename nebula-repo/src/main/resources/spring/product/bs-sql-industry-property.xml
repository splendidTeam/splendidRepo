<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">
	
	<bean id="Property.findIndustryPropertyListByIndustryId" class="loxia.dao.support.DynamicQueryHolder">
		<description>查询与所给行业相关联的属性</description>
		<constructor-arg>
			<value>
			 <![CDATA[ 
				SELECT
						tpp. ID as id, tpp. NAME as name, tpp.group_name as group_name, tpp.hasthumb as hasthumb, tpipr.industry_id as industry_id,
						tpp.is_common_industry as is_common_industry, tpp.lifecycle as lifecycle, tpp.required as required, tpp.searchable as searchable, tpipr.sort_no as sort_no,
						tpp.create_time as create_time, tpp.editing_type as editing_type, tpp.is_color_prop as is_color_prop, tpp.is_salep_rop as is_salep_rop
					FROM
						t_pd_property tpp,
					    t_pd_industry_property_relation tpipr
					WHERE
				    tpipr.property_id = tpp.Id		
					AND tpipr.industry_id = :industryId 
					AND tpp.lifecycle !=2
					order by tpipr.sort_No asc
				]]>
			</value>
		</constructor-arg>
	</bean>
	
	<bean id="Property.findEnableSelectPropertyListByIndustryId" class="loxia.dao.support.DynamicQueryHolder">
		<description>查询与所给行业不相关联的属性</description>
		<constructor-arg>
			<value>
			 <![CDATA[ 
				SELECT
						tpp. ID as id, tpp. NAME as name, tpp.group_name as group_name, tpp.hasthumb as hasthumb, 
						tpp.is_common_industry as is_common_industry, tpp.lifecycle as lifecycle, tpp.required as required, tpp.searchable as searchable,
						tpp.create_time as create_time, tpp.editing_type as editing_type, tpp.is_color_prop as is_color_prop, tpp.is_salep_rop as is_salep_rop
					FROM
						t_pd_property tpp
					WHERE
				  tpp.ID NOT IN (select tpipr.property_id from t_pd_industry_property_relation tpipr WHERE tpipr.industry_id = :industryId  )		
					AND tpp.lifecycle !=2
				]]>
			</value>
		</constructor-arg>
	</bean>

	<bean id="IndustryPropertyRelation.deleteIndustryPropertyRelation" class="loxia.dao.support.DynamicQueryHolder">
		<description>删除某属性与某行业的关联关系</description>
		<constructor-arg>
			<value>
			 <![CDATA[ 
				delete from t_pd_industry_property_relation tpipr where tpipr.industry_id = :industryId and tpipr.property_id = :propertyId
				]]>
			</value>
		</constructor-arg>
	</bean>

	<bean id="Item.findItemsByIndustryIdAndPropertyId" class="loxia.dao.support.DynamicQueryHolder">
		<description>找出属于某个行业且有某个属性的商品</description>
		<constructor-arg>
			<value>
			 <![CDATA[ 
				SELECT * from t_pd_item tpi WHERE tpi.industry_id = :industryId and tpi.ID IN (SELECT tpip.item_id from t_pd_item_properties tpip WHERE tpip.property_id = :propertyId)
				]]>
			</value>
		</constructor-arg>
	</bean>
	
	<bean id="IndustryPropertyRelation.updateIndustryPropertySort" class="loxia.dao.support.DynamicQueryHolder">
		<description>更新行业中属性的排序</description>
		<constructor-arg>
			<value>
			 <![CDATA[ 
			 	update t_pd_industry_property_relation set sort_no = :sortNo where industry_id = :industryId and property_id = :propertyId
				]]>
			</value>
		</constructor-arg>
	</bean>
	
	<bean id="IndustryPropertyRelation.findMaxIndustryPropertySortId" class="loxia.dao.support.DynamicQueryHolder">
		<description>查找出某个行业中属性排序的最大值</description>
		<constructor-arg>
			<value>
			 <![CDATA[ 
			 	SELECT max(sort_no) FROM t_pd_industry_property_relation WHERE industry_id = :industryId
				]]>
			</value>
		</constructor-arg>
	</bean>

</beans>



