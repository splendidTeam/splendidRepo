<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">
	
	<bean id="BundleSku.findByBundleId" class="loxia.dao.support.DynamicQueryHolder">
		<description>分页查询</description>
		<constructor-arg>
			<value>
				<![CDATA[  
		       		select 
		       			*
		       		from 
		       			t_pd_bundle_sku  
		       		where 
		       		    bundle_id = :bundleId
                 ]]>
			</value>
		</constructor-arg>
	</bean>
	
	<bean id="BundleSku.findByBundleElementId" class="loxia.dao.support.DynamicQueryHolder">
		<description>分页查询</description>
		<constructor-arg>
			<value>
				<![CDATA[  
		       		select 
		       			*
		       		from 
		       			t_pd_bundle_sku  
		       		where 
		       		    bundle_element_id = :bundleElementId
                 ]]>
			</value>
		</constructor-arg>
	</bean>

	<bean id="BundleSku.save" class="loxia.dao.support.DynamicQueryHolder">
		<description>保存bundleElement</description>
		<constructor-arg>
			<value>
				<![CDATA[
					INSERT into t_pd_bundle_sku (bundle_id, bundle_element_id, item_id, sales_price, sku_id, style)
						VALUES (:bundleId, :bundleElementId, :itemId, :salesPrice, :skuId, :style)
				]]>
			</value>
		</constructor-arg>
	</bean>
	
	<bean id="BundleSku.deleteByBundleId" class="loxia.dao.support.DynamicQueryHolder">
		<description>根据bundleId删除bundleElement</description>
		<constructor-arg>
			<value>
				<![CDATA[
					DELETE from t_pd_bundle_sku WHERE bundle_id = :bundleId
				]]>
			</value>
		</constructor-arg>
	</bean>
	
	<bean id="BundleSku.getBundleSkusPrice" class="loxia.dao.support.DynamicQueryHolder">
		<description></description>
		<constructor-arg>
			<value>
				<![CDATA[
					SELECT  
						b.id bundleId, b.item_id bundleItemId, bs.sku_id skuId, s.list_price listPrice, case b.price_type when 1 then s.sale_price when 2 then be.sales_price when 3 then bs.sales_price else s.sale_price end salesPrice 
					FROM 
						t_pd_bundle b
					INNER JOIN 
						t_pd_bundle_element be on be.bundle_id = b.id
					INNER JOIN 
						t_pd_bundle_sku bs on bs.bundle_element_id = be.id
					INNER JOIN 
						t_pd_sku s on bs.sku_id = s.id
					WHERE 
						b.item_id = :bundleItemId and bs.sku_id in (
						#foreach($id in $skuIds)
    						$id,
					 	#end
		       		 	-1)
				]]>
			</value>
		</constructor-arg>
	</bean>
	
	<bean id="BundleSku.getBundleSkuPrice" class="loxia.dao.support.DynamicQueryHolder">
		<description></description>
		<constructor-arg>
			<value>
				<![CDATA[
					SELECT  
						b.id bundleId, b.item_id bundleItemId, bs.sku_id skuId, s.list_price listPrice, case b.price_type when 1 then s.sale_price when 2 then be.sales_price when 3 then bs.sales_price else s.sale_price end salesPrice
					FROM 
						t_pd_bundle b
					INNER JOIN 
						t_pd_bundle_element be on be.bundle_id = b.id
					INNER JOIN 
						t_pd_bundle_sku bs on bs.bundle_element_id = be.id
					INNER JOIN 
						t_pd_sku s on bs.sku_id = s.id
					WHERE 
						b.item_id = :bundleItemId and bs.sku_id = :skuId
				]]>
			</value>
		</constructor-arg>
	</bean>
	
</beans>