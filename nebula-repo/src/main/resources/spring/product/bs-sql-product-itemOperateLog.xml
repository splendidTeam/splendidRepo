<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

	<bean id="ItemOperateLog.findByItemId" class="loxia.dao.support.DynamicQueryHolder">
		<description>根据itemId查询ItemOperateLog的最新的一条记录</description>
		<constructor-arg>
			<value>
				<![CDATA[ 
					select id from t_pd_item_operate_log where item_id = :itemId order by create_time desc limit 1
                 ]]>
			</value>
		</constructor-arg>
	</bean>
	
	
	<bean id="ItemOperateLog.findItemByconditions" class="loxia.dao.support.DynamicQueryHolder">
		<description></description>
		<constructor-arg>
			<value>
				<![CDATA[  
		       		select 
							tpii.code as code,
							tpiil.title as title,
							tpi.id as id,
							tpi.item_id as itemId,
							tpi.push_time as pushTime,
							tpi.sold_out_time as soldOutTime,
							tpi.push_operator_name as pushOperatorName,
							tpi.sold_out_operator_name as soldOutOperatorName,
							tpi.active_time as activeTime,
							tpi.create_time as createTime,
							tpi.update_time as updateTime
					  from 
					  		t_pd_item_operate_log tpi,t_pd_item tpii,t_pd_iteminfo tpiil
					  			
		 			  where 
		 			  	
		 			  		tpi.item_id = tpii.id 
		 			  	and 
		 			  		tpii.id = tpiil.item_id 
		 			  
		 			  		#if($code)
		 			  			and tpii.code LIKE :code  
		 			  		#end
		 			  		
		 			  		#if($title)
		 			  			and tpiil.title LIKE :title  
		 			  		#end
		 			  		
		 			  		#if($operateType == 1)
		 			  			#if($operateBeginTime)
		 			  				and tpi.push_time >= :operateBeginTime
		 			  			#end
		 			  			
		 			  			#if($operateEndTime)
		 			  					and tpi.push_time <= :operateEndTime
		 			  					and tpi.push_time > '1970-01-01'
		 			  			#end
		 			  			
		 			  			#if($operatorName)
		 			  				and tpi.push_operator_name LIKE :operatorName
		 			  			#end
		 			  		#end
		 			  		
		 			  		#if($operateType == 2)
		 			  			#if($operateBeginTime)
		 			  				and tpi.sold_out_time >= :operateBeginTime
		 			  			#end
		 			  			
		 			  			#if($operateEndTime)
		 			  					and tpi.sold_out_time <= :operateEndTime
		 			  					and tpi.sold_out_time > '1970-01-01'
		 			  			#end
		 			  			
		 			  			#if($operatorName)
		 			  				and tpi.sold_out_operator_name LIKE :operatorName
		 			  			#end
		 			  		#end
		 			  		
		 			  		#if($operateType == 3)
		 			  			#if($operateBeginTime)
		 			  				and  (tpi.push_time >= :operateBeginTime or tpi.sold_out_time >= :operateBeginTime)
		 			  			#end
		 			  			
		 			  			#if($operateEndTime)
		 			  					and  ((tpi.push_time <= :operateEndTime and tpi.push_time > '1970-01-01')
		 			  					or (tpi.sold_out_time <= :operateEndTime and tpi.sold_out_time > '1970-01-01'))
		 			  			#end
		 			  			
		 			  			#if($operatorName)
		 			  				and  (tpi.push_operator_name LIKE :operatorName or tpi.sold_out_operator_name LIKE :operatorName)
		 			  			#end
		 			  		#end

							#if($activeTime)
		 			  				and tpi.active_time >= :activeTime
		 			  		#end
                 ]]>
			</value>
		</constructor-arg>
	</bean>
</beans>