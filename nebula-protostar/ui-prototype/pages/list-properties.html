<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>无标题文档</title>

<link rel="stylesheet" type="text/css" href="../css/main.css" />
<link rel="stylesheet" type="text/css"
	href="../css/demo.css" />

<script type="text/javascript" src="../scripts/jquery/jquery-1.9.1.js"></script>
<script type="text/javascript">
	var $j = jQuery.noConflict();
</script>

<script type="text/javascript"
	src="../scripts/jquery/jquery-migrate-1.2.0.js"></script>
<script type="text/javascript"
	src="../scripts/jquery/jqueryui/jquery-ui-1.10.2.custom.js"></script>
<script type="text/javascript"
	src="../scripts/jquery/jqueryui/jquery-ui-timepicker-addon.js"></script>

<script type="text/javascript"
	src="../scripts/loxia2/jquery.loxiacore-2.js"></script>
<script type="text/javascript"
	src="../scripts/loxia2/jquery.loxiainput-2.js"></script>
<script type="text/javascript"
	src="../scripts/loxia2/jquery.loxiaselect-2.js"></script>
<script type="text/javascript"
	src="../scripts/loxia2/jquery.loxiatable-2.js"></script>
<script type="text/javascript"
	src="../scripts/loxia2/jquery.loxia.locale-zh-CN.js"></script>


<script type="text/javascript"
	src="../scripts/nebula/jquery.nebula.protostar-1.js"></script>
<script type="text/javascript"
	src="../scripts/jquery/ztree/jquery.ztree.all-3.5.js"></script>


<script type="text/javascript">

	function propertyValue(data, args, idx) {
		var html = "<a href='update-propertie.html' class='func-button modify'>修改</a>";

		html += "<a href='javascript:void();' class='func-button enable'>禁用</a>";
		html += "<a href='javascript:void();' class='func-button delete'>删除</a>";
		html += "&nbsp;<a href='industry-property-value.html' class='func-button setproval'>设置属性可选值</a>"

		return html;
	}
	
	var industrySetting = {
			check: {
				enable: true,
				chkStyle: "radio",
				radioType: "all"
			},
			view: {
				dblClickExpand: true,
				showIcon:false
			},
			data: {
				simpleData: {
					enable: true
				}
			},
			callback: {
				onClick: onClick,
				onCheck: onCheck,
			}
		};

	var industryzNodes = [ {
		id : 1,
		pId : 0,
		name : "鞋",
		open : true,
		nocheck : true
	}, {
		id : 11,
		pId : 1,
		name : "运动鞋"
	}, {
		id : 12,
		pId : 1,
		name : "休闲鞋"
	}, {
		id : 2,
		pId : 0,
		name : "服装",
		open : true,
		nocheck : true
	}, {
		id : 21,
		pId : 2,
		name : "T恤"
	}, {
		id : 22,
		pId : 2,
		name : "裤子"
	}, {
		id : 23,
		pId : 2,
		name : "卫衣"
	}, {
		id : 3,
		pId : 0,
		name : "配件",
		open : true,
		nocheck : true
	}, {
		id : 31,
		pId : 3,
		name : "帽子"
	}, {
		id : 32,
		pId : 3,
		name : "手套"
	}, {
		id : 33,
		pId : 3,
		name : "袜子"
	} ];

	//****************************************indutryDemo start***********
	function onClick(e, treeId, treeNode) {
		var zTree = $j.fn.zTree.getZTreeObj("industryDemo");
		zTree.checkNode(treeNode, !treeNode.checked, null, true);
		return false;
	}

	function onCheck(e, treeId, treeNode) {
		var zTree = $j.fn.zTree.getZTreeObj("industryDemo"),
		nodes = zTree.getCheckedNodes(true),
		v = "";
		for (var i=0, l=nodes.length; i<l; i++) {
			v += nodes[i].name + ",";
		}
		if (v.length > 0 ) v = v.substring(0, v.length-1);
		var cityObj = $j("#industry");
		cityObj.attr("value", v);
		hideMenu();
	}
	function hideMenu() {
		$j("#industryContent").fadeOut("fast");
		$j("body").unbind("mousedown", onBodyDown);
	}
	function onBodyDown(event) {
		if (!(event.target.id == "menuBtn" || event.target.id == "industry" || event.target.id == "industryContent" || $j(event.target).parents("#industryContent").length>0)) {
			hideMenu();
		}
	}
    function deleteProp(data,args,caller){
        nps.confirm("确认删除", "确定要删除选定的属性么？", function() {
            alert(data.name + " is Deleted");
            refreshData();
        });
    }
	//*********************************indutryDemo end*****************
	
	var check = "";

	$j(document).ready(
					function() {
						loxia.init({
							debug : true,
							region : 'zh-CN'
						});
						nps.init();

						$j("#table1").loxiasimpletable({
							page : true,

							cols : [ {
								label : "<input type='checkbox'/>",
								witdh : "15",
								template : "drawCheckbox"
							},

							{
								name : "name",
								label : "属性名称"
							},

							{
								name : "edit",
								label : "编辑类型"
							}, {
								name : "value",
								label : "值类型"
							}, {
								name : "sale",
								label : "销售属性"
							}, {
								name : "color",
								label : "颜色属性"
							}, {
								name : "required",
								label : "必输属性"
							}, {
								name : "searchable",
								label : "是否检索"
							}, {
								name : "pic",
								label : "是否配图"
							}, {
								name : "sortno",
								label : "顺序"
							}, {
								name : "industry",
								label : "所属行业"
							}, {
								name : "status",
								label : "状态",
								type:"yesno"
							},

							{
								label : "操作",
								width : "20%",
								type : "oplist",
                                oplist: function(data){
                                    var list = [{label:"修改", type:"href", content:"update-propertie.html?id=" + data.name},
                                        {label:"禁用", type:"jsfunc", content:"disableProp"},
                                        {label:"删除", type:"jsfunc", content:"deleteProp"},
                                        {label:"设置属性可选值", type:"href", content:"industry-property-value.html?id=${{name}}"}];
                                    if(!data.status){
                                        list[1].label = "启用";
                                        list[1].content = "enableProp";
                                    }
                                    return list;
                                }
							} ],
							dataurl : {
								currentPage : 1,
								totalPages : 10,
								count : 99,
								size : 10,
								sortStr : "createtime desc",
								firstPage : true,
								lastPage : false,
								items : [

								{
									industry : "鞋",
									name : "颜色",
									createtime : "2013-03-05",
									status : 1,
									type : 1
								}, {
									industry : "鞋",
									name : "尺码",
									createtime : "2013-03-05",
									status : 1,
									type : 1
								}, {
									industry : "鞋",
									name : "材料",
									createtime : "2013-03-05",
									status : 1,
									type : 1
								}, {
									industry : "鞋",
									name : "品牌",
									createtime : "2013-03-05",
									status : 1,
									type : 2
								}, {
									industry : "鞋",
									name : "版本",
									createtime : "2013-03-05",
									status : 1,
									type : 2
								}, {
									industry : "鞋",
									name : "材质",
									createtime : "2013-03-05",
									status : 0,
									type : 1
								}

								]
							}
						});

						refreshData();

						

					    //显示industry行业下拉树
					    $j.fn.zTree.init($j("#industryDemo"), industrySetting, industryzNodes);
					  	//让商品分类下拉树只有叶子节点可选
						var treeObjIndustry = $j.fn.zTree.getZTreeObj("industryDemo");
						//1.将所有的节点转换为简单 Array 格式
						var nodesIndustry = treeObjIndustry.transformToArray(treeObjIndustry.getNodes());
						for(var i = 0;i<nodesIndustry.length;i++){
							//2.如果此节点为父节点 或者 为ROOT节点 ，则让此节点没有radio选框
							if(nodesIndustry[i].isParent || nodesIndustry[i].id == 0){
								nodesIndustry[i].nocheck = true;
							}
							treeObjIndustry.refresh();
						}
						
					    $j("#industry").click(function() {
							var cityObj = $j(this);
							var cityOffset = $j(this).offset();
							$j("#industryContent").css({left:cityOffset.left + "px", top:cityOffset.top + cityObj.outerHeight() + "px"}).slideDown("fast");

							$j("body").bind("mousedown", onBodyDown);
						});

						$j(".button.orange.add").on("click", function() {
							alert(check);
							hideMenu();
						});

					});
	function drawCheckbox(data, args, idx) {
		return "<input type='checkbox' name='id' value='"
				+ loxia.getObject("name", data) + "'/>";
	}

	function confirmDelete(){
		nps.confirm("确认删除","确定要删除选定的属性么？", function(){
	        alert("Deleted");
	        refreshData();
	    });
	}
	
	function refreshData() {

		$j("#table1").loxiasimpletable("refresh", {
			currentPage : 1,
			totalPages : 10,
			count : 99,
			size : 10,
			sortStr : "createtime asc",
			firstPage : true,
			lastPage : false,
			items : [

			{
				industry : "鞋",
				name : "颜色",
				createtime : "2013-03-05",
				status : 1,
				type : 1
			}, {
				industry : "鞋",
				name : "尺码",
				createtime : "2013-03-05",
				status : 1,
				type : 1
			}, {
				industry : "鞋",
				name : "材料",
				createtime : "2013-03-05",
				status : 1,
				type : 1
			}, {
				industry : "鞋",
				name : "品牌",
				createtime : "2013-03-05",
				status : 1,
				type : 1
			}, {
				industry : "鞋",
				name : "版本",
				createtime : "2013-03-05",
				status : 1,
				type : 2
			}, {
				industry : "鞋",
				name : "材质",
				createtime : "2013-03-05",
				status : 0,
				type : 2
			} ]
		});

		$j(".button.addlistpro").click(function() {
			window.location.href = "add-propertie.html";
		});

		$j(".func-button.delete").on("click", function() {
			nps.confirm("确认删除", "确定要删除选定的属性么？", function() {
				alert("Deleted");
				refreshData();
			});
		});
		
		$j(".func-button.modify").on("click",function() {
			window.location.href = "update-propertie.html";
		});
		//设置属性可选值
		$j(".func-button.setproval").on("click",function() {
			window.location.href = "industry-property-value.html";
		});
		//禁用
		$j(".func-button.enable").on("click",function() {
			
		});
	}
</script>

<script type="text/javascript" src="../scripts/main.js"></script>

</head>
<body>
	<div class="content-box">
		<div class="ui-title1">
			<img src="../images/wmi/blacks/32x32/spechbubble.png">商品属性管理 
				<input	type="button" value="批量删除" class="button" onclick="confirmDelete()" title="批量删除" />
			<input type="button" value="新增" class="button orange addlistpro" title="新增"/>
		</div>
		<div class="ui-block">
			<div class="ui-block-content ui-block-content-lb">
				<table>
					<tr>
						<td><label>属性名称</label></td>
						<td><span><input type="text"
								loxiaType="input" mandatory="false" placeholder="属性名称"></input></span></td>
						<td><label>所属行业</label></td>
						<td>
							<div class="wl-right">
		              			<input type="text" id="industry" loxiaType="input" placeholder="行业"/>
		         			</div>
						</td>
						<td>                
							<label>状态</label>
						</td>
						<td><span id="searchkeytext">
								<select loxiaType="select">
									<option>不限</option>
									<option>有效</option>
									<option>无效</option>
								<select>
							</span>
						</td>
					</tr>
				</table>
				<div class="button-line1">
					<a href="javascript:void(0);" class="func-button"><span>搜索</span></a>
				</div>
			</div>
		</div>
		<div class="ui-block">
   	 		<div class="border-grey" id="table1" caption="属性列表"></div>
    	</div>

		<div class="button-line">
			<input type="button" value="新增" class="button orange addlistpro" title="新增"/> 
			<input type="button" value="批量删除" class="button" onclick="confirmDelete()" title="批量删除"/>
		</div>
	</div>
	<div id="industryContent" class="menuContent" style="display:none; position: absolute; background-color:#f0f6e4;border: 1px solid #617775;padding:3px;">
		<ul id="industryDemo" class="ztree" style="margin-top:0; width:180px; height: 100%;"></ul>
	</div>
</body>
</html>
