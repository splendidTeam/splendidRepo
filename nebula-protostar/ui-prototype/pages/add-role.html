<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>无标题文档</title>
<link rel="stylesheet" type="text/css" href="../css/main.css"/>
<link rel="stylesheet" href="../css/demo.css" type="text/css">

<script type="text/javascript" src="../scripts/jquery/jquery-1.9.1.js"></script>


<script type="text/javascript" src="../scripts/jquery/jquery-migrate-1.2.0.js"></script>
<script type="text/javascript" src="../scripts/jquery/jqueryui/jquery-ui-1.10.2.custom.js"></script>
<script type="text/javascript" src="../scripts/jquery/jqueryui/jquery-ui-timepicker-addon.js"></script>

<script type="text/javascript" src="../scripts/loxia2/jquery.loxiacore-2.js"></script>
<script type="text/javascript" src="../scripts/loxia2/jquery.loxiainput-2.js"></script>
<script type="text/javascript" src="../scripts/loxia2/jquery.loxiaselect-2.js"></script>
<script type="text/javascript" src="../scripts/loxia2/jquery.loxiatable-2.js"></script>
<script type="text/javascript" src="../scripts/loxia2/jquery.loxia.locale-zh-CN.js"></script>
<script type="text/javascript" src="../scripts/jquery/jqueryui/jquery.ui.datepicker-zh-CN.js"></script>

<script type="text/javascript" src="../scripts/nebula/jquery.nebula.protostar-1.js"></script>

<style type="text/css">
.wl-right-auto2
{


border:1px solid #ccc;
overflow-y:scroll;

}
.wl-right-auto2  input[type="checkbox"]
{
clear:both;
}

.wl-right-auto2  input[type="radio"]
{
clear:both;
}
.wl-right-auto2  p
{
width:80%;
}
</style>
<script type="text/javascript">
var $j = jQuery.noConflict();

$j.extend(loxia.regional['zh-CN'],{
    "PWD_NOT_MATCH":"密码输入不一致",
    "EMAIL_NOT_VALID":"邮箱不符合规则",
    "MOBILE_NOT_VALID":"手机不符合规则",
    "ORG_NOT_SELECT":"请选择所属组织"
});


function userFormValidate(form){
   
    console.log("xxx");
    if($j("input[name='pwd']").val() != $j("input[name='pwd1']").val()){
    	 return loxia.getLocaleMsg("PWD_NOT_MATCH");
        
    }

    var emailreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
   
    if(!emailreg.test($j("input[name='email']").val()))
     {
                 
         return loxia.getLocaleMsg("EMAIL_NOT_VALID");
                
     }

    var mobilereg=/^((13[0-9]{1})|(15[0-9]{1}))+\d{8}$/;
    if(!mobilereg.test($j("input[name='mobile']").val()))
    {
                
        return loxia.getLocaleMsg("MOBILE_NOT_VALID");
               
    }

    var selVal=$j("input[name='rad_user_org']:checked").val();
   
    if(selVal== undefined ||selVal==''){
    	 return loxia.getLocaleMsg("ORG_NOT_SELECT");
      }
    
    return loxia.SUCCESS;  
}

function changeOrg(){

	var selVal=$j("input[name='rad_user_org']:checked").val();

	if(selVal=='系统'){
		var html=' <li>系统</li><li>店铺系统一</li><li>店铺系统二</li><li>店铺常规一</li><li>店铺常规二</li>';
		$j(".org_list").html(html);
		
	}
	else{
		$j(".org_list").html("<li>"+selVal+"</li>");
	}

	refreshRoleSel();

	$j("#org_role").show();
}

function refreshRoleSel(){
	$j(".ui-tag-change").each(function(){
		$j(this).find("li").eq(0).addClass("selected");
		$j(this).find(".tag-change-content").find(".tag-change-in").eq(0).show();
		$j(this).find("li").on("click",function(){
			var thisindex=$j(".ui-tag-change ul li").index($j(this));
			$j(this).addClass("selected").siblings("li").removeClass("selected");
			$j(".tag-change-in").eq(thisindex).css("display","block").siblings(".tag-change-in").css("display","none");
		});
	});
}

$j(document).ready(function(){
	loxia.init({debug: true, region: 'zh-CN'});
    nps.init();

    $j(".orgSelect").change(function(){

    	var selVal=$j(".orgSelect").val();
    	
    	
    	if(selVal=='系统'){

    		if($j(".orgRel").attr("checked")=="checked"){
    			$j(".org_list").html("<li>系统(联动选择所有店铺)</li>");
        	}

    		else{
    			var html=' <li>系统</li><li>店铺1</li><li>店铺2</li><li>店铺3</li>';
    			$j(".org_list").html(html);
    		}
    	}

    	else{
    		$j(".org_list").html("<li>"+selVal+"</li>");
    	}

    	refreshRoleSel();

    	$j("#org_role").show();
    });
});

</script>
<script type="text/javascript" src="../scripts/jquery/jquery-1.9.1.js"></script>
<script type="text/javascript" src="../scripts/jquery/ztree/jquery.ztree.all-3.5.js"></script>

<SCRIPT type="text/javascript">
		
		var setting = {
			view: {
				selectedMulti: false
			},
			check: {
				enable: true
			},
			edit: {
				enable: true
			},
			data: {
				keep: {
					parent:true,
					leaf:true
				},
				key: {
					title: "title"
				},
				simpleData: {
					enable: true
				}
			},
			callback: {
				beforeDrag: beforeDrag,
				beforeRemove: beforeRemove,
				beforeRename: beforeRename,
				onRemove: onRemove,
				onCheck: onCheck
			}
		};

		var zNodes =[
			{ id:1, pId:0, name:"系统管理", open:true},
			{ id:11, pId:1, name:"用户管理", open:true},
			{ id:111, pId:11, name:"用户列表"},
			{ id:12, pId:1, name:"叶子节点 1-2"},
			{ id:13, pId:1, name:"叶子节点 1-3"},
			{ id:2, pId:0, name:"父节点 2", open:true},
			{ id:21, pId:2, name:"叶子节点 2-1"},
			{ id:22, pId:2, name:"叶子节点 2-2"},
			{ id:23, pId:2, name:"叶子节点 2-3"},
			{ id:3, pId:0, name:"父节点 3", open:true},
			{ id:31, pId:3, name:"叶子节点 3-1"},
			{ id:32, pId:3, name:"叶子节点 3-2"},
			{ id:33, pId:3, name:"叶子节点 3-3"}
		];
		
		/*add*/
		var log, className = "dark";
		function beforeDrag(treeId, treeNodes) {
			return false;
		}
		function beforeRemove(treeId, treeNode) {
			className = (className === "dark" ? "":"dark");
			showLog("[ "+getTime()+" beforeRemove ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name);
			return confirm("确认删除 节点 -- " + treeNode.name + " 吗？");
		}
		function onRemove(e, treeId, treeNode) {
			showLog("[ "+getTime()+" onRemove ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name);
		}
		function beforeRename(treeId, treeNode, newName) {
			if (newName.length == 0) {
				alert("节点名称不能为空.");
				var zTree = $.fn.zTree.getZTreeObj("treeDemo");
				setTimeout(function(){zTree.editName(treeNode)}, 10);
				return false;
			}
			return true;
		}
		function showLog(str) {
			if (!log) log = $("#log");
			log.append("<li class='"+className+"'>"+str+"</li>");
			if(log.children("li").length > 8) {
				log.get(0).removeChild(log.children("li")[0]);
			}
		}
		function getTime() {
			var now= new Date(),
			h=now.getHours(),
			m=now.getMinutes(),
			s=now.getSeconds(),
			ms=now.getMilliseconds();
			return (h+":"+m+":"+s+ " " +ms);
		}

		var newCount = 1;
		function add(e) {
			var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
			isParent = e.data.isParent,
			nodes = zTree.getSelectedNodes(),
			treeNode = nodes[0];
			if (treeNode) {
				treeNode = zTree.addNodes(treeNode, {id:(100 + newCount), pId:treeNode.id, isParent:isParent, name:"new node" + (newCount++)});
			} else {
				treeNode = zTree.addNodes(null, {id:(100 + newCount), pId:0, isParent:isParent, name:"new node" + (newCount++)});
			}
			if (treeNode) {
				zTree.editName(treeNode[0]);
			} else {
				alert("叶子节点被锁定，无法增加子节点");
			}
		};
		function edit() {
			var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
			nodes = zTree.getSelectedNodes(),
			treeNode = nodes[0];
			if (nodes.length == 0) {
				alert("请先选择一个节点");
				return;
			}
			zTree.editName(treeNode);
		};
		function remove(e) {
			var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
			nodes = zTree.getSelectedNodes(),
			treeNode = nodes[0];
			if (nodes.length == 0) {
				alert("请先选择一个节点");
				return;
			}
			var callbackFlag = $("#callbackTrigger").attr("checked");
			zTree.removeNode(treeNode, callbackFlag);
		};
		function clearChildren(e) {
			var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
			nodes = zTree.getSelectedNodes(),
			treeNode = nodes[0];
			if (nodes.length == 0 || !nodes[0].isParent) {
				alert("请先选择一个父节点");
				return;
			}
			zTree.removeChildNodes(treeNode);
		};
		/*add-end*/
		
		function onCheck(e, treeId, treeNode) {
			count();
		}
		
		function setTitle(node) {
			var zTree = $.fn.zTree.getZTreeObj("treeDemo");
			var nodes = node ? [node]:zTree.transformToArray(zTree.getNodes());
			for (var i=0, l=nodes.length; i<l; i++) {
				var n = nodes[i];
				n.title = "[" + n.id + "] isFirstNode = " + n.isFirstNode + ", isLastNode = " + n.isLastNode;
				zTree.updateNode(n);
			}
		}
		function count() {
			function isForceHidden(node) {
				if (!node.parentTId) return false;
				var p = node.getParentNode();
				return !!p.isHidden ? true : isForceHidden(p);
			}
			var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
			checkCount = zTree.getCheckedNodes(true).length,
			nocheckCount = zTree.getCheckedNodes(false).length,
			hiddenNodes = zTree.getNodesByParam("isHidden", true),
			hiddenCount = hiddenNodes.length;

			for (var i=0, j=hiddenNodes.length; i<j; i++) {
				var n = hiddenNodes[i];
				if (isForceHidden(n)) {
					hiddenCount -= 1;
				} else if (n.isParent) {
					hiddenCount += zTree.transformToArray(n.children).length;
				}
			}

			$("#isHiddenCount").text(hiddenNodes.length);
			$("#hiddenCount").text(hiddenCount);
			$("#checkCount").text(checkCount);
			$("#nocheckCount").text(nocheckCount);
		}
		function showNodes() {
			var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
			nodes = zTree.getNodesByParam("isHidden", true);
			zTree.showNodes(nodes);
			setTitle();
			count();
		}
		function hideNodes() {
			var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
			nodes = zTree.getSelectedNodes();
			if (nodes.length == 0) {
				alert("请至少选择一个节点");
				return;
			}
			zTree.hideNodes(nodes);
			setTitle();
			count();
		}
		

		function beforeDrag(treeId, treeNodes) {
			return false;
		}
		
		function setEdit() {
			var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
			remove = $("#remove").attr("checked"),
			rename = $("#rename").attr("checked"),
			removeTitle = $.trim($("#removeTitle").val()),
			renameTitle = $.trim($("#renameTitle").val());
			zTree.setting.edit.showRemoveBtn = remove;
			zTree.setting.edit.showRenameBtn = rename;
			zTree.setting.edit.removeTitle = removeTitle;
			zTree.setting.edit.renameTitle = renameTitle;
			showCode(['setting.edit.showRemoveBtn = ' + remove, 'setting.edit.showRenameBtn = ' + rename,
				'setting.edit.removeTitle = "' + removeTitle +'"', 'setting.edit.renameTitle = "' + renameTitle + '"']);
		}
		function showCode(str) {
			var code = $("#code");
			code.empty();
			for (var i=0, l=str.length; i<l; i++) {
				code.append("<li>"+str[i]+"</li>");
			}
		}
		
		$(document).ready(function(){
			$.fn.zTree.init($("#treeDemo"), setting, zNodes);
			setEdit();
			$("#remove").bind("change", setEdit);
			$("#rename").bind("change", setEdit);
			$("#removeTitle").bind("propertychange", setEdit)
			.bind("input", setEdit);
			$("#renameTitle").bind("propertychange", setEdit)
			.bind("input", setEdit);

			$("#hideNodesBtn").bind("click", {type:"rename"}, hideNodes);
			$("#showNodesBtn").bind("click", {type:"icon"}, showNodes);
			setTitle();
			count();
			
			
			$("#addParent").bind("click", {isParent:true}, add);
			$("#addLeaf").bind("click", {isParent:false}, add);
			$("#edit").bind("click", edit);
			$("#remove").bind("click", remove);
			$("#clearChildren").bind("click", clearChildren);
			
			$j(".button.orange.save").on("click",function(){
		    	
		    	nps.submitForm('userForm',{mode:'async'})
		    })
		    
		     $j(".button.return").on("click",function(){
		    	
		    	 location.href='list-role.html'
		    })
		});
		//-->
	</SCRIPT>

<script type="text/javascript" src="../scripts/main.js"></script>

</head>

<body>

<div class="content-box width-percent100">
    
     <form name="userForm" action="" method="post">
	<div class="ui-title1">
		<img src="../images/wmi/blacks/32x32/users.png">
	角色管理</div>
	<div class="ui-block">
    <div class="ui-block-title1">添加/修改角色</div>
    <div class="ui-block-content border-grey">
    <div class="ui-block-line">
         <label>角色名</label>
         <div >
              <input type="text" loxiaType="input" value="" mandatory="true"/>
         </div>
    </div>
    
    
    

    
    <div class="ui-block-line">
         <label>机构类型</label>
         <div>    
    			<select class="orgSelect" loxiaType="select">
    				<option value="系统">系统</option>
    				<option value="店铺1">店铺</option>
    				
    			</select>
    			
    			
         </div>
    </div>
    <div class="ui-block-line">
         <label>状态</label>
         <div >    
    			<select class="orgSelect" loxiaType="select">
    				<option value="有效">有效</option>
    				<option value="无效">无效</option>
    				
    			</select>
    			
    			
         </div>
    </div>
    
    
    <div class="ui-block-line"  id="org_role">
         <label>对应权限</label>
         <div >
         	  <ul id="treeDemo" class="ztree"></ul>
         </div>
    </div>
    </div>
	</div>
    </form>
    
 	<div class="button-line">
         <input type="button" value="保存" class="button orange save" title="保存"/>

         <input type="button" value="返回" class="button return" title="返回"/>
         
    </div>
</div>


</body>
</html>
