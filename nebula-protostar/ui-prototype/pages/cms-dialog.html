<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>无标题文档</title>

<link rel="stylesheet" type="text/css" href="../css/main.css" />
<link rel="stylesheet" type="text/css"
	href="../css/demo.css" />

<script type="text/javascript" src="../scripts/jquery/jquery-1.9.1.js"></script>
<script type="text/javascript">
	var $j = jQuery.noConflict();
</script>

<script type="text/javascript"
	src="../scripts/jquery/jquery-migrate-1.2.0.js"></script>
<script type="text/javascript"
	src="../scripts/jquery/jqueryui/jquery-ui-1.10.2.custom.js"></script>
<script type="text/javascript"
	src="../scripts/jquery/jqueryui/jquery-ui-timepicker-addon.js"></script>

<script type="text/javascript"
	src="../scripts/loxia2/jquery.loxiacore-2.js"></script>
<script type="text/javascript"
	src="../scripts/loxia2/jquery.loxiainput-2.js"></script>
<script type="text/javascript"
	src="../scripts/loxia2/jquery.loxiaselect-2.js"></script>
<script type="text/javascript"
	src="../scripts/loxia2/jquery.loxiatable-2.js"></script>
<script type="text/javascript"
	src="../scripts/loxia2/jquery.loxia.locale-zh-CN.js"></script>
	<script type="text/javascript" src="../scripts/loxia2/jquery.loxia.locale-zh-CN.js"></script>
	<script type="text/javascript" src="../scripts/jquery/jqueryui/jquery.ui.datepicker-zh-CN.js"></script>


<script type="text/javascript"
	src="../scripts/nebula/jquery.nebula.protostar-1.js"></script>
<script type="text/javascript"
	src="../scripts/jquery/ztree/jquery.ztree.all-3.5.js"></script>

<script type="text/javascript">
	var copyUri=null;
	
	var setting = {

		check : {
			enable : false
		},
		view : {
			showIcon : false,
			fontCss : getFontCss
		},
		edit : {
			enable : false,
			showRenameBtn : false
		},
		data : {
			keep : {
				parent : false,
				leaf : false
			},
			key : {
				title : "name"
			},
			simpleData : {
				enable : true
			}
		},
		callback : {
			onClick : onClick
		}
	};
	
	var zNodes = [ {
		id : 0,
		pId : -1,
		name : "所有对话框",
		open : true,
		nocheck : true
	}, {
		id : 1,
		pId : 0,
		name : "KV对话框",
		open : true,
		nocheck : true
	}, {
		id : 11,
		pId : 1,
		name : "左右切换对话框"
	}, {
		id : 12,
		pId : 1,
		name : "序号切换对话框",
		nocheck : true
	}, {
		id : 2,
		pId : 0,
		name : "图片链接对话框",
		open : true,
		nocheck : true
	}, {
		id : 21,
		pId : 2,
		name : "外链对话框"
	}, {
		id : 3,
		pId : 0,
		name : "商品对话框",
		open : true,
		nocheck : true
	}, {
		id : 31,
		pId : 3,
		name : "商品基本信息对话框"
	}, {
		id : 32,
		pId : 3,
		name : "评论对话框"
	}, {
		id : 33,
		pId : 3,
		name : "商品销售对话框"
	} ];



	function onClick(event, treeId, treeNode) {
		//refreshData();
	}

	function getFontCss(treeId, treeNode) {
		return (!!treeNode.highlight) ? {
			color : "#333",
			"background-color" : "yellow"
		} : {
			color : "#333",
			"font-weight" : "normal",
			"background-color" : ""
		};
	}
	
	function modifiedTemp(data, args, idx){
		var html='';
		
		if(loxia.getObject("modified", data)){
			
			html+='<span class="ui-pyesno ui-pyesno-yes">Y</span>';
		}
		else{
			html+='<span class="ui-pyesno ui-pyesno-no">N</span>';
		}
		
		if(loxia.getObject("modifiydate", data)!=null&&loxia.getObject("modifiydate", data)!=''){
			html+=loxia.getObject("modifiydate", data);
		}
		
		return html;
	}
	
	function publishedTemp(data, args, idx){
		var html='';
		
		if(loxia.getObject("published", data)){
			
			html+='<span class="ui-pyesno ui-pyesno-yes">Y</span>';
		}
		else{
			html+='<span class="ui-pyesno ui-pyesno-no">N</span>';
		}
		
		if(loxia.getObject("publishDate", data)!=null&&loxia.getObject("publishDate", data)!=''){
			html+=loxia.getObject("publishDate", data);
		}
		
		return html;
	}
	
	function drawCheckbox(data, args, idx) {
		return "<input type='checkbox' name='id' value='"
				+ loxia.getObject("name", data) + "'/>";
	}

	function refreshData() {
		$j("#table1").loxiasimpletable("refresh", {
			currentPage : 1,
			totalPages : 10,
			count : 99,
			size : 10,
			firstPage : true,
			lastPage : false,
			items : [ 
				{path:"/body/nike",discription : "评论对话框",extend : "/body/global"},
				{path:"/body/nike",discription : "评论对话框",extend : "/body/global"},
				{path:"/body/nike",discription : "评论对话框",extend : "/body/global"},
				{path:"/body/nike",discription : "评论对话框",extend : "/body/global"},
				{path:"/body/nike",discription : "评论对话框",extend : "/body/global"},
			]
		});

	}
	function onClick1(e, treeId, treeNode) {
		var zTree = $j.fn.zTree.getZTreeObj("categoryDemo");
		zTree.checkNode(treeNode, !treeNode.checked, null, true);
		return false;
	}

	function onCheck1(e, treeId, treeNode) {
		var zTree = $j.fn.zTree.getZTreeObj("categoryDemo"),
		nodes = zTree.getCheckedNodes(true),
		v = "";
		for (var i=0, l=nodes.length; i<l; i++) {
			v += nodes[i].name + ",";
		}
		if (v.length > 0 ) v = v.substring(0, v.length-1);
		var cityObj = $j("#category");
		cityObj.attr("value", v);
		hideMenu1();
	}
	function hideMenu1() {
		$j("#categoryContent").fadeOut("fast");
		$j("body").unbind("mousedown", onBodyDown1);
	}
	function onBodyDown1(event) {
		if (!(event.target.id == "menuBtn" || event.target.id == "category" || event.target.id == "categoryContent" || $j(event.target).parents("#categoryContent").length>0)) {
			hideMenu1();
		}
	}

	$j(document).ready(function() {
		loxia.init({
			debug : true,
			region : 'zh-CN'
		});
		nps.init();
	

	    $j("#category").click(function() {
			var cityObj = $j(this);
			var cityOffset = $j(this).offset();
			$j("#categoryContent").css({left:cityOffset.left + "px", top:cityOffset.top + cityObj.outerHeight() + "px"}).slideDown("fast");

			$j("body").bind("mousedown", onBodyDown1);
		});

		$j("#table1").loxiasimpletable({
			page : true,
			
			cols : [ {
				label : "<input type='checkbox'/>",
				template : "drawCheckbox",
				width:"5%"
			}, {
				name : "path",
				label : "路径",
				width:"20%"
				
			}, {
				name : "discription",
				label : "描述",
				width:"35%"
				
			}, {
				name : "extend",
				label : "继承",
				width:"20%"
			},
			{label:"操作",width:"20%", 
				type : "oplist",
                oplist: function(data){
                    var list = [{label:"修改", type:"href", content:"cms-edit-dialog.html"},
                        {label:"删除", type:"jsfunc", content:"deleteProp"}
                       ];
                    return list;
                }
			}
			],
			dataurl : {
				currentPage : 1,
				totalPages : 10,
				count : 99,
				size : 10,
				firstPage : true,
				lastPage : false,
				items : [ 
							{path:"/body/nike",discription : "评论对话框",extend : "/body/global"},
							{path:"/body/nike",discription : "评论对话框",extend : "/body/global"},
							{path:"/body/nike",discription : "评论对话框",extend : "/body/global"},
							{path:"/body/nike",discription : "评论对话框",extend : "/body/global"},
							{path:"/body/nike",discription : "评论对话框",extend : "/body/global"},
				]
			}
		});
		
		refreshData();



		$j.fn.zTree.init($j("#tree"), setting, zNodes);
		$j(".button.orange.removesort").on("click", function(){
	        alert("脱离成功")
	    });
		$j(".button.orange.add").on("click", function(){
	       window.location.href='cms-edit-dialog.html';
	    });
		
		$j(".button.copy").on("click",function(){
			
			var ztree = $j.fn.zTree.getZTreeObj("tree");
			var uri=null;
			var id=null;
			var isParent=null;
			var nodes_ = ztree.getSelectedNodes(true);
			if(nodes_.length == 0){
				nps.info("错误提示：","请先在左侧选择要复制的结点!");
				return ;
			}else{
				//取到选择的行业名称
				for (var i=0, l=nodes_.length; i<l; i++) {
					uri = nodes_[i].uri ;
					id = nodes_[i].id ;
					isParent= nodes_[i].isParent;
				}
				
				if(isParent){
					nps.info("错误提示：","不能选择非叶子结点!");
					return ;
				}
				
				copyUri=uri;
				
			}
			
			$j("#copy-dialog").dialogff({type:'open',close:'in',width:'600px',height:'200px'});
		})
		
		$j(".button.orange.copyok").on("click",function(){
			var copyTo=$j("#copy-to-path").val();
			if(copyTo==""){
				nps.info("错误提示：","复制路径不能为空!");
				return ;
			}
			alert("copyTo:"+copyTo);
			$j("#copy-dialog").dialogff({type:'close'});
		})
		
		$j(".button.orange.copycancel").on("click",function(){
			
			$j("#copy-dialog").dialogff({type:'close'});
		})
		
	});
	
	
</script>

<script type="text/javascript" src="../scripts/main.js"></script>

</head>

<body>
    <div class="content-box">
		<div class="ui-title1"><img src="../images/wmi/blacks/32x32/users.png">属性定义管理
						<input type="button" value="删除" title="删除"  class="button remove"/>
						<input type="button" value="复制" title="复制"  class="button copy"/>		                
                        <input type="button" value="新增定义" title="新增定义"  class="button orange add" />
                        <input type="button" value="新增目录" title="新增目录"  class="button orange addfolder" />

		</div>

        <div class="ui-block ui-block-fleft w240">
            <div class="ui-block-content ui-block-content-lb">
                <div class="tree-control">
                    <input type="text" id="key" loxiatype="input" placeholder="输入关键字快速定位" />
                </div>
                <ul id="tree" class="ztree"></ul>

            </div>
        </div>
        
        <div class="ui-block ml240">
		    <div class="ui-block-content" style="padding-top:0;padding-right:0;">
			
			    <div class="ui-block">
			    	
			   	 	<div class="table-border0 border-grey" id="table1" caption="属性定义列表"></div>   
			    </div>
		
		    </div>
	   	</div>
	   	<div class="button-line">
	   					<input type="button" value="新增目录" title="新增目录"  class="button orange addfolder" />
                        <input type="button" value="新增定义" title="新增定义"  class="button orange add" />
						<input type="button" value="复制" title="复制"  class="button copy"/>
						<input type="button" value="删除" title="删除"  class="button remove"/>
        </div>

    </div>
    <div id="categoryContent" class="menuContent" style="z-index:999;display:none; position: absolute; background-color:#f0f6e4;border: 1px solid #617775;padding:3px;">
	   <ul id="categoryDemo" class="ztree" style="margin-top:0; width:180px; height: 100%;"></ul>
    </div>
    <div id="copy-dialog" class="proto-dialog">
		 <h5>复制信息</h5>
			 <div class="proto-dialog-content">
				 <div class="ui-block-line">
					<label>源路径</label>
					<div>    
					  <input type="text" readonly id="copy-source-path" loxiaType="input" value="" mandatory="false"/>
					</div>
					
					<label>目标路径</label>
					<div> 
					<input type="text" id="copy-to-path" loxiaType="input" value="" mandatory="false"/>
					</div>
				 </div>
			 </div>
			 <div class="proto-dialog-button-line">
			 	  <input type="button" value="确定" class="button orange copyok"/>
			 	  
			 	  <input type="button" value="取消" class="button orange copycancel"/>
			 </div>
	</div>
</body>
</html>
